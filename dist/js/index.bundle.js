(()=>{"use strict";const e={inputFieldStart:document.querySelector(".input__field-start"),inputFieldEnd:document.querySelector(".input__field-end"),showAsteroidBtn:document.querySelector(".input__btn"),testBtn:document.querySelector(".testBtn"),selectedAsteroidsList:document.querySelector(".selected-asteroids"),tableBody:document.querySelector("#tableBody"),asteroidInput:document.querySelector("#asteroids")};function t(t){return e[t]}const a=function(e){const a=t("tableBody");a.innerHTML="";for(let t in e){const n=e[t],r=document.createElement("tr"),i=[];i.push(n.dateOfApproach,n.name,n.speed,n.maxDiameter,n.minDiameter),i.forEach((e=>{const t=document.createElement("td");t.innerHTML=e,r.appendChild(t),a.appendChild(r)}))}},n=function(e,t,a){!0===t?e.sort(((e,t)=>e[a].localeCompare(t[a]))):e.sort(((e,t)=>t[a].localeCompare(e[a])))},r=function(e,t,a){!0===t?e.sort(((e,t)=>e[a]-t[a])):e.sort(((e,t)=>t[a]-e[a]))},i=[];t("showAsteroidBtn").addEventListener("click",(function(){let e=t("inputFieldStart").value,o=t("inputFieldEnd").value;(function(e,t){return""===e.value||""===t.value?(alert("Please select start and end dates!"),!1):!(parseInt(t.replace(/-/g,""),10)-parseInt(e.replace(/-/g,""),10)>7&&(alert("Maximum difference between dates is 7 days!"),1))})(e,o)&&async function(e,t){const a=`https://api.nasa.gov/neo/rest/v1/feed?start_date=${e}&end_date=${t}&api_key=x0HeIJzRCLm3lj0zrfXt2LltusKVCO7aoHmRkVq2`;try{const e=await fetch(a),t=await e.json();return await t.near_earth_objects}catch(e){alert("Error!")}}(e,o).then((e=>{const t=[],o=[];for(const a in e)for(let n=0;n<e[a].length;n++){let r=e[a][n];!0===r.is_potentially_hazardous_asteroid&&t.push(r)}for(const e in t){let a,n,r,s,c,d;a=t[e].close_approach_data[0].close_approach_date,n=t[e].name,r=t[e].close_approach_data[0].relative_velocity.kilometers_per_hour,s=t[e].estimated_diameter.meters.estimated_diameter_max,c=t[e].estimated_diameter.meters.estimated_diameter_min,d=t[e].id,o.push(d),i.push({dateOfApproach:a,name:n,speed:r,maxDiameter:s,minDiameter:c})}var s;a(i),s=o,i.map((e=>e.name)).forEach(((e,t)=>{const a=document.createElement("option");a.setAttribute("value",e),a.setAttribute("data-id",s[t]),document.getElementById("asteroid-list").appendChild(a)}));let c=!0;document.querySelector("tr").addEventListener("click",(e=>{"Ime"===e.target.innerHTML?((e=n)(i,c,"name"),c=!c,a(i)):"Datum"===e.target.innerHTML?((e=n)(i,c,"dateOfApproach"),c=!c,a(i)):"Brzina kretanja (km/h)"===e.target.innerHTML?((e=r)(i,c,"speed"),c=!c,a(i)):"Min. Precnik (m)"===e.target.innerHTML?((e=r)(i,c,"minDiameter"),c=!c,a(i)):"Max. Precnik (m)"===e.target.innerHTML&&((e=r)(i,c,"maxDiameter"),c=!c,a(i))}))}))})),t("testBtn").addEventListener("click",(function(){const e=document.querySelector(".selected-asteroids"),a=t("asteroidInput").value,n=document.querySelectorAll("option");let r=t("asteroidInput");a&&n.forEach((t=>{if(t.value===a){let n=document.createElement("li");n.setAttribute("data-id",t.getAttribute("data-id")),n.innerHTML=a,e.appendChild(n),n.classList.add("chosen-asteroid");let i='<button class="btn-delete">\n        <i class="ion-ios-close-outline"></i> \n     </button>';n.innerHTML+=i,t.remove(),r.value=""}}))})),t("selectedAsteroidsList").addEventListener("click",(function(e){let t=e.target.parentElement.parentElement;if(e.target.parentElement.matches(".btn-delete")){let e=document.querySelector("#asteroid-list"),a=document.createElement("option");a.setAttribute("value",t.childNodes[0].nodeValue),a.setAttribute("data-id",t.getAttribute("data-id")),e.appendChild(a),t.parentNode.removeChild(t)}})),document.querySelector(".chartPageBtn").addEventListener("click",(function(){const e=document.querySelectorAll(".chosen-asteroid");if(e.length>0)return function(e){const t=[],a=document.createElement("div");e.forEach((e=>{(async function(e){const t=`https://api.nasa.gov/neo/rest/v1/neo/${e}?api_key=x0HeIJzRCLm3lj0zrfXt2LltusKVCO7aoHmRkVq2`,a=await fetch(t);return await a.json()})(e.getAttribute("data-id")).then((e=>{const n=e.close_approach_data.filter((e=>parseInt(e.close_approach_date.substring(0,4),10)>1900&&parseInt(e.close_approach_date.substring(0,4),10)<1999)).length;t.push(n),a.innerHTML+=`<span class="chart-item">${e.name}</span><div class="chart"></div>`,localStorage.setItem("numOfApproach",JSON.stringify(t)),localStorage.setItem("item",JSON.stringify(a.innerHTML))}))}))}(e),void setTimeout((()=>{window.location="chart.html"}),1500);alert("Please select asteroids from table!")}))})();